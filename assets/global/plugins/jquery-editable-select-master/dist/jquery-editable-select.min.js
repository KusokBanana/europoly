+(function(a){EditableSelect=function(b,c){var d=this;this.options=c;this.$select=a(b);this.$input=a('<input type="text" autocomplete="off">');this.$list=a('<ul class="es-list">');this.utility=new EditableSelectUtility(this);if(["focus","manual"].indexOf(this.options.trigger)<0){this.options.trigger="focus"}if(["default","fade","slide"].indexOf(this.options.effects)<0){this.options.effects="default"}if(isNaN(this.options.duration)&&["fast","slow"].indexOf(this.options.duration)<0){this.options.duration="fast"}this.$select.replaceWith(this.$input);this.$list.appendTo(this.options.appendTo||this.$input.parent());this.utility.initialize();this.utility.initializeList();this.utility.initializeInput();this.utility.trigger("created")};EditableSelect.DEFAULTS={filter:true,effects:"default",duration:"fast",trigger:"focus"};EditableSelect.prototype.filter=function(){var c=0;var b=this.$input.val().toLowerCase().trim();var d=this.$list.find("li");if(this.$list.closest("th").length){d=this.$list.find("li.filtered-li")}d.addClass("es-visible").show();if(this.options.filter){c=this.$list.find("li").filter(function(f,e){return a(e).text().toLowerCase().indexOf(b)<0}).hide().removeClass("es-visible").length;if(this.$list.find("li").length==c){this.hide()}}};EditableSelect.prototype.show=function(){this.$list.css({top:this.$input.position().top+this.$input.outerHeight()-1,left:this.$input.position().left,width:this.$input.outerWidth()});if(!this.$list.is(":visible")&&this.$list.find("li.es-visible").length>0){var b={"default":"show",fade:"fadeIn",slide:"slideDown"};var c=b[this.options.effects];this.utility.trigger("show");this.$input.addClass("open");this.$list[c](this.options.duration,a.proxy(this.utility.trigger,this.utility,"shown"))}};EditableSelect.prototype.hide=function(){var b={"default":"hide",fade:"fadeOut",slide:"slideUp"};var c=b[this.options.effects];this.utility.trigger("hide");this.$input.removeClass("open");this.$list[c](this.options.duration,a.proxy(this.utility.trigger,this.utility,"hidden"))};EditableSelect.prototype.select=function(b){if(!this.$list.has(b)||!b.is("li.es-visible:not([disabled])")){return}this.$input.val(b.text());if(this.options.filter){this.hide()}this.filter();this.utility.trigger("select",b)};EditableSelect.prototype.add=function(g,c,b,e){var h=a("<li>").html(g);var f=a("<option>").text(g);var d=this.$list.find("li").length;if(isNaN(c)){c=d}else{c=Math.min(Math.max(0,c),d)}if(c==0){this.$list.prepend(h);this.$select.prepend(f)}else{this.$list.find("li").eq(c-1).after(h);this.$select.find("option").eq(c-1).after(f)}this.utility.setAttributes(h,b,e);this.utility.setAttributes(f,b,e);this.filter()};EditableSelect.prototype.remove=function(b){var c=this.$list.find("li").length;if(isNaN(b)){b=c}else{b=Math.min(Math.max(0,b),c-1)}this.$list.find("li").eq(b).remove();this.$select.find("option").eq(b).remove();this.filter()};EditableSelect.prototype.destroy=function(){this.$list.off("mousemove mousedown mouseup");this.$input.off("focus blur input keydown");this.$input.replaceWith(this.$select);this.$list.remove();this.$select.removeData("editable-select")};EditableSelectUtility=function(b){this.es=b};EditableSelectUtility.prototype.initialize=function(){var b=this;b.setAttributes(b.es.$input,b.es.$select[0].attributes,b.es.$select.data());b.es.$input.addClass("es-input").data("editable-select",b.es);b.es.$select.find("option").each(function(c,d){var e=a(d).remove();b.es.add(e.text(),c,d.attributes,e.data());if(e.attr("selected")){b.es.$input.val(e.text())}});b.es.filter()};EditableSelectUtility.prototype.initializeList=function(){var b=this;b.es.$list.on("mousemove","li:not([disabled])",function(){b.es.$list.find(".selected").removeClass("selected");a(this).addClass("selected")}).on("mousedown","li",function(c){if(a(this).is("[disabled]")){c.preventDefault()}else{b.es.select(a(this))}}).on("mouseup",function(){b.es.$list.find("li.selected").removeClass("selected")})};EditableSelectUtility.prototype.initializeInput=function(){var b=this;switch(this.es.options.trigger){default:case"focus":b.es.$input.on("focus",a.proxy(b.es.show,b.es)).on("blur",a.proxy(b.es.hide,b.es));break;case"manual":break}b.es.$input.on("input keydown",function(g){switch(g.keyCode){case 38:var f=b.es.$list.find("li.es-visible:not([disabled])");var d=f.filter("li.selected").prev();var c=f.index(d.length>0?d:f.last());b.highlight(c);g.preventDefault();break;case 40:var f=b.es.$list.find("li.es-visible:not([disabled])");var d=f.filter("li.selected").next();var c=f.index(d.length>0?d:f.first());b.highlight(c);g.preventDefault();break;case 13:if(b.es.$list.is(":visible")){b.es.select(b.es.$list.find("li.selected"));g.preventDefault()}break;case 9:case 27:b.es.hide();break;default:b.es.filter();b.highlight(0);break}})};EditableSelectUtility.prototype.highlight=function(b){var c=this;c.es.show();setTimeout(function(){var g=c.es.$list.find("li.es-visible");var i=c.es.$list.find("li.selected").removeClass("selected");var h=g.index(i);if(g.length>0){var d=(g.length+b)%g.length;var e=g.eq(d);var f=e.position().top;e.addClass("selected");if(d<h&&f<0){c.es.$list.scrollTop(c.es.$list.scrollTop()+f)}if(d>h&&f+e.outerHeight()>c.es.$list.outerHeight()){c.es.$list.scrollTop(c.es.$list.scrollTop()+e.outerHeight()+2*(f-c.es.$list.outerHeight()))}}})};EditableSelectUtility.prototype.setAttributes=function(b,c,d){a.each(c||{},function(f,e){b.attr(e.name,e.value)});b.data(d)};EditableSelectUtility.prototype.trigger=function(c){var d=Array.prototype.slice.call(arguments,1);var b=[c+".editable-select"];b.push(d);this.es.$select.trigger.apply(this.es.$select,b);this.es.$input.trigger.apply(this.es.$input,b)};Plugin=function(c){var b=Array.prototype.slice.call(arguments,1);return this.each(function(){var f=a(this);var e=f.data("editable-select");var d=a.extend({},EditableSelect.DEFAULTS,f.data(),typeof c=="object"&&c);if(!e){e=new EditableSelect(this,d)}if(typeof c=="string"){e[c].apply(e,b)}})};a.fn.editableSelect=Plugin;a.fn.editableSelect.Constructor=EditableSelect})(jQuery);